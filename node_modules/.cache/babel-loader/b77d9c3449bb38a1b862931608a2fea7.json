{"ast":null,"code":"import { persistReducer } from 'redux-persist';\nimport storage from 'redux-persist/lib/storage';\nimport { put, takeLatest } from 'redux-saga/effects';\nimport { getUserByToken } from './AuthCRUD';\nimport axios from 'utils/AxiosConfig';\nexport const actionTypes = {\n  Login: '[Login] Action',\n  Logout: '[Logout] Action',\n  Register: '[Register] Action',\n  UserRequested: '[Request User] Action',\n  UserLoaded: '[Load User] Auth API',\n  SetUser: '[Set User] Action'\n};\nconst initialAuthState = {\n  user: undefined,\n  accessToken: undefined\n};\nexport const reducer = persistReducer({\n  storage,\n  key: 'v1-auth',\n  whitelist: ['accessToken']\n}, function () {\n  let state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialAuthState;\n  let action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case actionTypes.Login:\n      {\n        var _action$payload;\n\n        const accessToken = (_action$payload = action.payload) === null || _action$payload === void 0 ? void 0 : _action$payload.accessToken;\n        return {\n          accessToken,\n          user: undefined\n        };\n      }\n\n    case actionTypes.Register:\n      {\n        var _action$payload2;\n\n        const accessToken = (_action$payload2 = action.payload) === null || _action$payload2 === void 0 ? void 0 : _action$payload2.accessToken;\n        return {\n          accessToken,\n          user: undefined\n        };\n      }\n\n    case actionTypes.Logout:\n      {\n        return initialAuthState;\n      }\n\n    case actionTypes.UserRequested:\n      {\n        return { ...state,\n          user: undefined\n        };\n      }\n\n    case actionTypes.UserLoaded:\n      {\n        var _action$payload3;\n\n        const user = (_action$payload3 = action.payload) === null || _action$payload3 === void 0 ? void 0 : _action$payload3.user;\n        return { ...state,\n          user\n        };\n      }\n\n    case actionTypes.SetUser:\n      {\n        var _action$payload4;\n\n        const user = (_action$payload4 = action.payload) === null || _action$payload4 === void 0 ? void 0 : _action$payload4.user;\n        return { ...state,\n          user\n        };\n      }\n\n    default:\n      return state;\n  }\n});\nexport const actions = {\n  login: accessToken => ({\n    type: actionTypes.Login,\n    payload: {\n      accessToken\n    }\n  }),\n  register: accessToken => ({\n    type: actionTypes.Register,\n    payload: {\n      accessToken\n    }\n  }),\n  logout: () => ({\n    type: actionTypes.Logout\n  }),\n  requestUser: () => ({\n    type: actionTypes.UserRequested\n  }),\n  fulfillUser: user => ({\n    type: actionTypes.UserLoaded,\n    payload: {\n      user\n    }\n  }),\n  setUser: user => ({\n    type: actionTypes.SetUser,\n    payload: {\n      user\n    }\n  })\n};\nexport function* saga() {\n  yield takeLatest(actionTypes.Login, function* loginSaga(data) {\n    axios.defaults.headers.common['Authorization'] = data.payload.accessToken || \"\";\n    yield put(actions.requestUser());\n  });\n  yield takeLatest(actionTypes.Register, function* registerSaga() {\n    yield put(actions.requestUser());\n  });\n  yield takeLatest(actionTypes.UserRequested, function* userRequested() {\n    const {\n      data: user\n    } = yield getUserByToken();\n    yield put(actions.fulfillUser(user.user));\n  });\n}","map":{"version":3,"names":["persistReducer","storage","put","takeLatest","getUserByToken","axios","actionTypes","Login","Logout","Register","UserRequested","UserLoaded","SetUser","initialAuthState","user","undefined","accessToken","reducer","key","whitelist","state","action","type","payload","actions","login","register","logout","requestUser","fulfillUser","setUser","saga","loginSaga","data","defaults","headers","common","registerSaga","userRequested"],"sources":["C:/Users/KT2/OneDrive/Documents/Buffh/ssc.fe.cheatview-main/src/app/modules/auth/redux/AuthRedux.ts"],"sourcesContent":["import {Action} from '@reduxjs/toolkit'\nimport {persistReducer} from 'redux-persist'\nimport storage from 'redux-persist/lib/storage'\nimport {put, takeLatest} from 'redux-saga/effects'\nimport {UserModel} from '../models/UserModel'\nimport {getUserByToken} from './AuthCRUD'\nimport axios from 'utils/AxiosConfig';\nexport interface ActionWithPayload<T> extends Action {\n  payload?: T\n}\n\nexport const actionTypes = {\n  Login: '[Login] Action',\n  Logout: '[Logout] Action',\n  Register: '[Register] Action',\n  UserRequested: '[Request User] Action',\n  UserLoaded: '[Load User] Auth API',\n  SetUser: '[Set User] Action',\n}\n\nconst initialAuthState: IAuthState = {\n  user: undefined,\n  accessToken: undefined,\n}\n\nexport interface IAuthState {\n  user?: UserModel\n  accessToken?: string\n}\n\nexport const reducer = persistReducer(\n  {storage, key: 'v1-auth', whitelist: ['accessToken']},\n  (state: IAuthState = initialAuthState, action: ActionWithPayload<IAuthState>) => {\n    switch (action.type) {\n      case actionTypes.Login: {\n        const accessToken = action.payload?.accessToken\n        return {accessToken, user: undefined}\n      }\n\n      case actionTypes.Register: {\n        const accessToken = action.payload?.accessToken\n        return {accessToken, user: undefined}\n      }\n\n      case actionTypes.Logout: {\n        return initialAuthState\n      }\n\n      case actionTypes.UserRequested: {\n        return {...state, user: undefined}\n      }\n\n      case actionTypes.UserLoaded: {\n        const user = action.payload?.user\n        return {...state, user}\n      }\n\n      case actionTypes.SetUser: {\n        const user = action.payload?.user\n        return {...state, user}\n      }\n\n      default:\n        return state\n    }\n  }\n)\n\nexport const actions = {\n  login: (accessToken: string) => ({type: actionTypes.Login, payload: {accessToken}}),\n  register: (accessToken: string) => ({\n    type: actionTypes.Register,\n    payload: {accessToken},\n  }),\n  logout: () => ({type: actionTypes.Logout}),\n  requestUser: () => ({\n    type: actionTypes.UserRequested,\n  }),\n  fulfillUser: (user: UserModel) => ({type: actionTypes.UserLoaded, payload: {user}}),\n  setUser: (user: UserModel) => ({type: actionTypes.SetUser, payload: {user}}),\n}\n\nexport function* saga() {\n  yield takeLatest(actionTypes.Login, function* loginSaga(data:any) {\n    axios.defaults.headers.common['Authorization'] = data.payload.accessToken || \"\";\n    yield put(actions.requestUser())\n  })\n\n  yield takeLatest(actionTypes.Register, function* registerSaga() {\n    yield put(actions.requestUser())\n  })\n\n  yield takeLatest(actionTypes.UserRequested, function* userRequested() {\n    const {data: user} = yield getUserByToken()\n\n    yield put(actions.fulfillUser(user.user))\n  })\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}