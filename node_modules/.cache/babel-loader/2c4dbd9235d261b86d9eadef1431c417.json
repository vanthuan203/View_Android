{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/KT2/OneDrive/Documents/Buffh/ssc.fe.cheatview-main/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/KT2/OneDrive/Documents/Buffh/ssc.fe.cheatview-main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/KT2/OneDrive/Documents/Buffh/ssc.fe.cheatview-main/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useRef,useEffect,useState}from'react';import axios from'utils/AxiosConfig';import{shallowEqual,useSelector,connect,useDispatch}from'react-redux';import{LayoutSplashScreen}from'../../../../_metronic/layout/core';import*as auth from'./AuthRedux';import{getUserByToken}from'./AuthCRUD';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var mapState=function mapState(state){return{auth:state.auth};};var connector=connect(mapState,auth.actions);var AuthInit=function AuthInit(props){var didRequest=useRef(false);var dispatch=useDispatch();var _useState=useState(true),_useState2=_slicedToArray(_useState,2),showSplashScreen=_useState2[0],setShowSplashScreen=_useState2[1];var accessToken=useSelector(function(_ref){var auth=_ref.auth;return auth.accessToken;},shallowEqual);// We should request user by authToken before rendering the application\nuseEffect(function(){var requestUser=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$getUserByToken,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(didRequest.current){_context.next=13;break;}_context.next=4;return accessToken;case 4:_context.t0=_context.sent;if(_context.t0){_context.next=7;break;}_context.t0=\"\";case 7:axios.defaults.headers.common['Authorization']=_context.t0;_context.next=10;return getUserByToken();case 10:_yield$getUserByToken=_context.sent;data=_yield$getUserByToken.data;dispatch(props.fulfillUser(data.user));case 13:_context.next=19;break;case 15:_context.prev=15;_context.t1=_context[\"catch\"](0);console.error(_context.t1);if(!didRequest.current){dispatch(props.logout());}case 19:_context.prev=19;setShowSplashScreen(false);return _context.finish(19);case 22:return _context.abrupt(\"return\",function(){return didRequest.current=true;});case 23:case\"end\":return _context.stop();}}},_callee,null,[[0,15,19,22]]);}));return function requestUser(){return _ref2.apply(this,arguments);};}();if(accessToken){requestUser();}else{dispatch(props.logout());setShowSplashScreen(false);}// eslint-disable-next-line\n},[]);return showSplashScreen?/*#__PURE__*/_jsx(LayoutSplashScreen,{}):/*#__PURE__*/_jsx(_Fragment,{children:props.children});};export default connector(AuthInit);","map":{"version":3,"names":["useRef","useEffect","useState","axios","shallowEqual","useSelector","connect","useDispatch","LayoutSplashScreen","auth","getUserByToken","mapState","state","connector","actions","AuthInit","props","didRequest","dispatch","showSplashScreen","setShowSplashScreen","accessToken","requestUser","current","defaults","headers","common","data","fulfillUser","user","console","error","logout","children"],"sources":["C:/Users/KT2/OneDrive/Documents/Buffh/ssc.fe.cheatview-main/src/app/modules/auth/redux/AuthInit.tsx"],"sourcesContent":["import {FC, useRef, useEffect, useState} from 'react'\nimport axios from 'utils/AxiosConfig';\nimport {shallowEqual, useSelector, connect, useDispatch, ConnectedProps} from 'react-redux'\nimport {LayoutSplashScreen} from '../../../../_metronic/layout/core'\nimport * as auth from './AuthRedux'\nimport {getUserByToken} from './AuthCRUD'\nimport {RootState} from '../../../../setup'\n\n\nconst mapState = (state: RootState) => ({auth: state.auth})\nconst connector = connect(mapState, auth.actions)\ntype PropsFromRedux = ConnectedProps<typeof connector>\n\nconst AuthInit: FC<PropsFromRedux> = (props) => {\n  const didRequest = useRef(false)\n  const dispatch = useDispatch()\n  const [showSplashScreen, setShowSplashScreen] = useState(true)\n  const accessToken = useSelector<RootState>(({auth}) => auth.accessToken, shallowEqual)\n  // We should request user by authToken before rendering the application\n  useEffect(() => {\n    const requestUser = async () => {\n      try {\n        if (!didRequest.current) {\n          axios.defaults.headers.common['Authorization'] = await accessToken || \"\";\n          const {data}:any = await getUserByToken()\n          dispatch(props.fulfillUser(data.user))\n        }\n      } catch (error) {\n        console.error(error)\n        if (!didRequest.current) {\n          dispatch(props.logout())\n        }\n      } finally {\n        setShowSplashScreen(false)\n      }\n\n      return () => (didRequest.current = true)\n    }\n\n    if (accessToken) {\n      requestUser()\n    } else {\n      dispatch(props.logout())\n      setShowSplashScreen(false)\n    }\n    // eslint-disable-next-line\n  }, [])\n\n  return showSplashScreen ? <LayoutSplashScreen /> : <>{props.children}</>\n}\n\nexport default connector(AuthInit)\n"],"mappings":"mcAAA,OAAYA,MAAZ,CAAoBC,SAApB,CAA+BC,QAA/B,KAA8C,OAA9C,CACA,MAAOC,MAAP,KAAkB,mBAAlB,CACA,OAAQC,YAAR,CAAsBC,WAAtB,CAAmCC,OAAnC,CAA4CC,WAA5C,KAA8E,aAA9E,CACA,OAAQC,kBAAR,KAAiC,mCAAjC,CACA,MAAO,GAAKC,KAAZ,KAAsB,aAAtB,CACA,OAAQC,cAAR,KAA6B,YAA7B,C,gGAIA,GAAMC,SAAQ,CAAG,QAAXA,SAAW,CAACC,KAAD,QAAuB,CAACH,IAAI,CAAEG,KAAK,CAACH,IAAb,CAAvB,EAAjB,CACA,GAAMI,UAAS,CAAGP,OAAO,CAACK,QAAD,CAAWF,IAAI,CAACK,OAAhB,CAAzB,CAGA,GAAMC,SAA4B,CAAG,QAA/BA,SAA+B,CAACC,KAAD,CAAW,CAC9C,GAAMC,WAAU,CAAGjB,MAAM,CAAC,KAAD,CAAzB,CACA,GAAMkB,SAAQ,CAAGX,WAAW,EAA5B,CACA,cAAgDL,QAAQ,CAAC,IAAD,CAAxD,wCAAOiB,gBAAP,eAAyBC,mBAAzB,eACA,GAAMC,YAAW,CAAGhB,WAAW,CAAY,kBAAEI,KAAF,MAAEA,IAAF,OAAYA,KAAI,CAACY,WAAjB,EAAZ,CAA0CjB,YAA1C,CAA/B,CACA;AACAH,SAAS,CAAC,UAAM,CACd,GAAMqB,YAAW,6FAAG,uLAEXL,UAAU,CAACM,OAFA,gDAGyCF,YAHzC,qFAGwD,EAHxD,QAGdlB,KAAK,CAACqB,QAAN,CAAeC,OAAf,CAAuBC,MAAvB,CAA8B,eAA9B,CAHc,oCAIWhB,eAAc,EAJzB,6CAIPiB,IAJO,uBAIPA,IAJO,CAKdT,QAAQ,CAACF,KAAK,CAACY,WAAN,CAAkBD,IAAI,CAACE,IAAvB,CAAD,CAAR,CALc,yFAQhBC,OAAO,CAACC,KAAR,cACA,GAAI,CAACd,UAAU,CAACM,OAAhB,CAAyB,CACvBL,QAAQ,CAACF,KAAK,CAACgB,MAAN,EAAD,CAAR,CACD,CAXe,yBAahBZ,mBAAmB,CAAC,KAAD,CAAnB,CAbgB,mEAgBX,iBAAOH,WAAU,CAACM,OAAX,CAAqB,IAA5B,EAhBW,6EAAH,kBAAXD,YAAW,2CAAjB,CAmBA,GAAID,WAAJ,CAAiB,CACfC,WAAW,GACZ,CAFD,IAEO,CACLJ,QAAQ,CAACF,KAAK,CAACgB,MAAN,EAAD,CAAR,CACAZ,mBAAmB,CAAC,KAAD,CAAnB,CACD,CACD;AACD,CA3BQ,CA2BN,EA3BM,CAAT,CA6BA,MAAOD,iBAAgB,cAAG,KAAC,kBAAD,IAAH,cAA4B,yBAAGH,KAAK,CAACiB,QAAT,EAAnD,CACD,CApCD,CAsCA,cAAepB,UAAS,CAACE,QAAD,CAAxB"},"metadata":{},"sourceType":"module"}